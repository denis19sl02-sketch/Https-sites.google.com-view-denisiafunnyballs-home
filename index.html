<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C# Master Pro: Constructor Mode</title>
    <style>
        :root {
            --duo-green: #58cc02; --duo-blue: #1cb0f6;
            --duo-red: #ff4b4b; --duo-gray: #e5e5e5;
            --code-bg: #282c34;
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #fff; overflow-x: hidden; text-align: center; }

        /* –ö–∞—Ä—Ç–∞ –∏ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .header-nav { display: flex; justify-content: space-around; padding: 15px; border-bottom: 2px solid var(--duo-gray); sticky: top; background: white; z-index: 100; }
        .stat { font-weight: bold; font-size: 20px; display: flex; align-items: center; gap: 8px; }
        .map { max-width: 400px; margin: 20px auto; padding-bottom: 50px; }
        .node { width: 70px; height: 70px; border-radius: 50%; margin: 15px auto; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; cursor: pointer; border-bottom: 5px solid rgba(0,0,0,0.2); }
        .locked { background: var(--duo-gray); cursor: not-allowed; }
        .active { background: var(--duo-green); transform: scale(1.1); }
        .done { background: #ffc800; }

        /* –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã */
        #game-view { display: none; position: fixed; inset: 0; background: white; flex-direction: column; z-index: 200; }
        .progress-bar { padding: 20px; display: flex; align-items: center; gap: 15px; }
        .bar-bg { flex-grow: 1; height: 12px; background: var(--duo-gray); border-radius: 10px; }
        #bar-fill { width: 0%; height: 100%; background: var(--duo-green); border-radius: 10px; transition: 0.3s; }

        /* –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∫–æ–¥–∞ */
        .question-title { font-size: 22px; padding: 0 20px; color: #3c3c3c; }
        .drop-zone { 
            min-height: 100px; width: 90%; max-width: 500px; 
            background: #f7f7f7; border: 2px dashed #ccc; 
            margin: 20px auto; border-radius: 15px; padding: 15px;
            display: flex; flex-wrap: wrap; gap: 10px; align-content: flex-start;
        }
        .blocks-zone { 
            width: 90%; max-width: 500px; margin: 10px auto; 
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center;
        }
        .code-block { 
            padding: 10px 18px; background: white; border: 2px solid var(--duo-gray); 
            border-bottom: 4px solid var(--duo-gray); border-radius: 12px; 
            cursor: pointer; font-family: monospace; font-size: 16px; font-weight: bold;
        }
        .code-block:active { transform: translateY(2px); border-bottom-width: 2px; }

        .footer { padding: 25px; border-top: 2px solid var(--duo-gray); margin-top: auto; }
        #check-btn { width: 100%; max-width: 400px; padding: 18px; background: var(--duo-green); color: white; border: none; border-bottom: 4px solid #46a302; border-radius: 15px; font-weight: bold; cursor: pointer; }

        /* –§–∏–¥–±–µ–∫ */
        .feedback { display: none; position: fixed; bottom: 0; width: 100%; padding: 30px; box-sizing: border-box; font-weight: bold; z-index: 300; }
        .correct { background: #d7ffb8; color: #58a700; }
        .wrong { background: #ffdfe0; color: #ea2b2b; }
    </style>
</head>
<body>

<div id="menu-view">
    <div class="header-nav">
        <div class="stat">üî• <span id="streak-count">0</span></div>
        <div class="stat">üöÄ –£—Ä. <span id="level-num">1</span></div>
    </div>
    <div class="map" id="map-container"></div>
</div>

<div id="game-view">
    <div class="progress-bar">
        <span onclick="goBack()" style="cursor:pointer; font-size:25px;">‚úï</span>
        <div class="bar-bg"><div id="bar-fill"></div></div>
    </div>
    <h3 class="question-title" id="q-title">–°–æ–±–µ—Ä–∏ –∫–æ–¥ –ø–æ –∫—É—Å–∫–∞–º</h3>
    <div class="drop-zone" id="drop-zone" onclick="clearLastBlock()"></div>
    <div class="blocks-zone" id="blocks-zone"></div>
    <div class="footer">
        <button id="check-btn" onclick="checkCode()">–ü–†–û–í–ï–†–ò–¢–¨</button>
    </div>
    <div id="fb-panel" class="feedback">
        <span id="fb-msg"></span>
        <button onclick="nextQ()" style="float:right; padding:12px 25px; border-radius:10px; border:none; cursor:pointer; font-weight:bold;">–î–ê–õ–ï–ï</button>
    </div>
</div>

<script>
    const sndOk = new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3');
    const sndErr = new Audio('https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3');

    // –û–ì–†–û–ú–ù–ê–Ø –ë–ê–ó–ê –í–û–ü–†–û–°–û–í (–°–õ–û–ñ–ù–û–°–¢–¨ +5% –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê –ß–ï–†–ï–ó –ò–ù–î–ï–ö–°–´)
    const allQuestions = [
        // 1-5 –£—Ä–æ–≤–Ω–∏: –û—Å–Ω–æ–≤—ã
        { t: "–û–±—ä—è–≤–∏ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ 5", a: ["int", "x", "=", "5", ";"] },
        { t: "–í—ã–≤–µ–¥–∏ —Ç–µ–∫—Å—Ç Hello", a: ["Console", ".", "WriteLine", "(", "\"Hello\"", ")", ";"] },
        { t: "–°–æ–∑–¥–∞–π –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤", a: ["int", "[]", "arr", "=", "new", "int", "[0]", ";"] },
        // 6-15 –£—Ä–æ–≤–Ω–∏: –õ–æ–≥–∏–∫–∞ –∏ —Ü–∏–∫–ª—ã
        { t: "–¶–∏–∫–ª –æ—Ç 0 –¥–æ 9", a: ["for", "(", "int", "i=0;", "i<10;", "i++", ")"] },
        { t: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ", a: ["if", "(", "a", "==", "b", ")", "return", "true", ";"] },
        { t: "–°–æ–∑–¥–∞–π —Å–ø–∏—Å–æ–∫ —Å—Ç—Ä–æ–∫", a: ["List<string>", "list", "=", "new", "List<string>", "()", ";"] },
        // 16-30 –£—Ä–æ–≤–Ω–∏: –û–û–ü –∏ PRO
        { t: "–ù–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞", a: ["public", "class", "Car", ":", "Vehicle", "{", "}"] },
        { t: "–õ—è–º–±–¥–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (LINQ)", a: ["var", "res", "=", "list", ".", "Where", "(x", "=>", "x>0", ")", ";"] },
        { t: "–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ—Ç–æ–¥", a: ["public", "async", "Task", "Get()", "{", "await", "Done();", "}"] }
    ];

    let currentLvl = parseInt(localStorage.getItem('cs_pro_idx')) || 0;
    let streak = parseInt(localStorage.getItem('cs_streak')) || 0;
    let step = 0;
    let userAssembly = [];
    let sessionQs = [];

    function init() {
        const cont = document.getElementById('map-container');
        cont.innerHTML = "";
        for(let i=0; i<30; i++) {
            const d = document.createElement('div');
            d.className = `node ${i < currentLvl ? 'done' : (i === currentLvl ? 'active' : 'locked')}`;
            d.innerText = i + 1;
            d.onclick = () => { if(i === currentLvl) startLevel(i); };
            cont.appendChild(d);
        }
        document.getElementById('level-num').innerText = currentLvl + 1;
        document.getElementById('streak-count').innerText = streak;
    }

    function startLevel(lvl) {
        step = 0;
        sessionQs = [];
        // –ù–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ 5 –≤–æ–ø—Ä–æ—Å–æ–≤, —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Ç–µ—Ç
        for(let i=0; i<5; i++) {
            let poolIdx = Math.min(allQuestions.length - 1, Math.floor(lvl / 2) + Math.floor(Math.random() * 3));
            sessionQs.push(allQuestions[poolIdx]);
        }
        document.getElementById('menu-view').style.display = "none";
        document.getElementById('game-view').style.display = "flex";
        loadQuestion();
    }

    function loadQuestion() {
        const q = sessionQs[step];
        document.getElementById('q-title').innerText = q.t;
        document.getElementById('bar-fill').style.width = (step * 20) + "%";
        userAssembly = [];
        renderAssembly();

        const blocksZone = document.getElementById('blocks-zone');
        blocksZone.innerHTML = "";
        
        // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –±–ª–æ–∫–∏
        let shuffled = [...q.a].sort(() => Math.random() - 0.5);
        shuffled.forEach(word => {
            const b = document.createElement('div');
            b.className = "code-block";
            b.innerText = word;
            b.onclick = () => {
                userAssembly.push(word);
                b.style.display = "none";
                renderAssembly();
            };
            blocksZone.appendChild(b);
        });
        document.getElementById('fb-panel').style.display = "none";
    }

    function renderAssembly() {
        const zone = document.getElementById('drop-zone');
        zone.innerHTML = "";
        userAssembly.forEach(word => {
            const b = document.createElement('div');
            b.className = "code-block";
            b.style.borderColor = "var(--duo-blue)";
            b.innerText = word;
            zone.appendChild(b);
        });
    }

    function clearLastBlock() {
        if(userAssembly.length === 0) return;
        const last = userAssembly.pop();
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –±–ª–æ–∫ –≤ –Ω–∏–∂–Ω—é—é –∑–æ–Ω—É
        const blocks = document.getElementById('blocks-zone').children;
        for(let b of blocks) {
            if(b.innerText === last && b.style.display === "none") {
                b.style.display = "block";
                break;
            }
        }
        renderAssembly();
    }

    function checkCode() {
        const correct = sessionQs[step].a;
        const isRight = JSON.stringify(userAssembly) === JSON.stringify(correct);
        const fb = document.getElementById('fb-panel');
        fb.style.display = "block";
        fb.className = "feedback " + (isRight ? "correct" : "wrong");
        document.getElementById('fb-msg').innerText = isRight ? "–ì–ï–ù–ò–ê–õ–¨–ù–û!" : "–û–®–ò–ë–ö–ê –í –°–ò–ù–¢–ê–ö–°–ò–°–ï!";
        isRight ? sndOk.play() : sndErr.play();
    }

    function nextQ() {
        step++;
        if(step < 5) loadQuestion();
        else finishLvl();
    }

    function finishLvl() {
        currentLvl++;
        streak++;
        localStorage.setItem('cs_pro_idx', currentLvl);
        localStorage.setItem('cs_streak', streak);
        goBack();
    }

    function goBack() {
        document.getElementById('menu-view').style.display = "block";
        document.getElementById('game-view').style.display = "none";
        init();
    }

    init();
</script>
</body>
</html>

